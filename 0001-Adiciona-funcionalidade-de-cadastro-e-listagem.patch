From 179c234ae333fbbe6c4dc36648d13d04277b7b3c Mon Sep 17 00:00:00 2001
From: Sergio Vilar <sergio@vilar.cc>
Date: Wed, 27 Nov 2024 20:17:32 -0300
Subject: [PATCH 1/1] Adiciona funcionalidade de cadastro e listagem

Signed-off-by: Sergio Vilar <sergio@vilar.cc>
---
 banco.sql      |  30 +++++++++++++
 cadastrar.php  |  41 +++++++++++++++++
 codigo.php     |  51 ----------------------
 config.php     |  29 +++++++++----
 crieconta.html |  35 ---------------
 index.php      | 116 +++++++++++++++++++++++++++++++++++++++++++++++++
 inserir.php    |  27 ++++++++++++
 7 files changed, 234 insertions(+), 95 deletions(-)
 create mode 100644 banco.sql
 create mode 100644 cadastrar.php
 delete mode 100644 codigo.php
 delete mode 100644 crieconta.html
 create mode 100644 index.php
 create mode 100644 inserir.php

diff --git a/banco.sql b/banco.sql
new file mode 100644
index 0000000..2be4ff6
--- /dev/null
+++ b/banco.sql
@@ -0,0 +1,30 @@
+/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
+/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
+/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
+/*!40101 SET NAMES utf8mb4 */;
+/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
+/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
+/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
+/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
+
+DROP TABLE IF EXISTS `usuario`;
+CREATE TABLE `usuario` (
+  `id` int(11) NOT NULL AUTO_INCREMENT,
+  `nome` varchar(100) NOT NULL,
+  `email` varchar(100) NOT NULL,
+  `senha` varchar(255) NOT NULL,
+  `data_nascimento` date NOT NULL,
+  `created_at` timestamp NOT NULL DEFAULT current_timestamp(),
+  PRIMARY KEY (`id`),
+  UNIQUE KEY `email` (`email`)
+) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
+
+
+
+/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
+/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
+/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
+/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
+/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
+/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
+/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;
\ No newline at end of file
diff --git a/cadastrar.php b/cadastrar.php
new file mode 100644
index 0000000..cff9bb2
--- /dev/null
+++ b/cadastrar.php
@@ -0,0 +1,41 @@
+<!DOCTYPE html>
+<html lang="pt-BR">
+  <head>
+    <meta charset="UTF-8" />
+    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
+    <link rel="stylesheet" href="crieconta.css" />
+    <title>Cadastro de Produtos</title>
+  </head>
+
+  <body>
+    <form method="POST" action="inserir.php" class="container_cadastro">
+      <h2>Cadastro de Produtos</h2>
+
+      <div class="form-group">
+        <label for="nome" class="cadastro">Nome do Produto: </label>
+        <br />
+        <input type="text" id="nome" name="nome" required />
+      </div>
+
+      <div class="form-group">
+        <label for="codigo" class="cadastro">Código do Produto: </label>
+        <br />
+        <input type="text" id="codigo" name="codigo" required />
+      </div>
+
+      <div class="form-group">
+        <label for="preco" class="cadastro">Preço: </label>
+        <br />
+        <input type="number" id="preco" name="preco" step="0.01" min="0" required />
+      </div>
+
+      <div class="form-group">
+        <label for="estoque" class="cadastro">Quantidade em Estoque: </label>
+        <br />
+        <input type="number" id="estoque" name="estoque" min="0" required />
+      </div>
+
+      <button type="submit" class="submit-btn">Cadastrar</button>
+    </form>
+  </body>
+</html>
diff --git a/codigo.php b/codigo.php
deleted file mode 100644
index 5182e93..0000000
--- a/codigo.php
+++ /dev/null
@@ -1,51 +0,0 @@
-<?php
-// Ativa a exibição de erros para facilitar o desenvolvimento
-ini_set('display_errors', 1);
-ini_set('display_startup_errors', 1);
-error_reporting(E_ALL);
-
-// Inclui o arquivo de configuração do banco
-include('config.php');
-
-// Cria a conexão com o banco de dados
-$conexao = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);
-
-// Verifica a conexão
-if ($conexao->connect_error) {
-    die("Erro de conexão: " . $conexao->connect_error);
-}
-
-// Verifica se o formulário foi enviado (método POST)
-if ($_SERVER['REQUEST_METHOD'] === 'POST') {
-    // Obtém os dados do formulário
-    $nome = $_POST['nome'] ?? '';
-    $email = $_POST['email'] ?? '';
-    $senha = $_POST['senha'] ?? '';
-    $dataNascimento = $_POST['dataNascimento'] ?? '';
-
-    // Valida se os campos estão preenchidos
-    if (empty($nome) || empty($email) || empty($senha) || empty($dataNascimento)) {
-        die("Erro: Todos os campos são obrigatórios.");
-    }
-
-    // Criptografa a senha para armazenamento seguro
-    $senhaCriptografada = password_hash($senha, PASSWORD_DEFAULT);
-
-    // Prepara a consulta SQL para inserir os dados no banco
-    $queryInserir = "INSERT INTO usuarios (nome, email, senha, data_nascimento) VALUES (?, ?, ?, ?)";
-    $stmt = $conexao->prepare($queryInserir);
-    $stmt->bind_param("ssss", $nome, $email, $senhaCriptografada, $dataNascimento);
-
-    // Executa a consulta e verifica se foi bem-sucedida
-    if ($stmt->execute()) {
-        echo "Cadastro realizado com sucesso!";
-    } else {
-        echo "Erro ao salvar no banco: " . $stmt->error;
-    }
-
-    // Fecha a declaração preparada
-    $stmt->close();
-}
-
-// Fecha a conexão com o banco de dados
-$conexao->close();
diff --git a/config.php b/config.php
index afef7f1..bacc70a 100644
--- a/config.php
+++ b/config.php
@@ -1,15 +1,26 @@
 <?php
-$dbHost = 'Localhost';
+// Ativa a exibição de erros
+ini_set('display_errors', 1);
+ini_set('display_startup_errors', 1);
+error_reporting(E_ALL);
+
+$dbHost = 'localhost';
 $dbUsername = 'root';
 $dbPassword = '';
 $dbName = 'dados_doceria';
-?>
+$port = 3306;
+
+// Cria a conexão com o banco de dados
+$db = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName, $port);
 
-// Verificar se a conexão foi efetuada
-// $conexao = new mysqli($dbHost, $dbUsername, $dbPassword, $dbName);
+// Verifica a conexão
+if ($db->connect_error) {
+    die("Erro de conexão: " . $conexao->connect_error);
+}
 
-// if ($conexao->connect_errno) {
-// echo "erro";
-// } else {
-// echo "deu certo";
-// }
\ No newline at end of file
+function close_and_exit($db) {
+  $db->close();
+  exit;
+}
+
+?>
diff --git a/crieconta.html b/crieconta.html
deleted file mode 100644
index 27aa848..0000000
--- a/crieconta.html
+++ /dev/null
@@ -1,35 +0,0 @@
-<!DOCTYPE html>
-<html lang="pt-BR">
-  <head>
-    <meta charset="UTF-8" />
-    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
-    <link rel="stylesheet" href="crieconta.css" />
-    <title>Crie sua conta</title>
-  </head>
-
-  <body>
-    <form class="container_cadastro">
-      <h2>Cadastro</h2>
-
-      <div class="form-group">
-        <label for="nome" class="cadastro">Nome Completo: </label>
-        <br />
-        <input type="text" id="nome" name="nome" required />
-      </div>
-
-      <div class="form-group">
-        <label for="email" class="cadastro">E-mail: </label>
-        <br />
-        <input type="email" id="email" name="email" required />
-      </div>
-
-      <div class="form-group">
-        <label for="senha" class="cadastro">Senha: </label>
-        <br />
-        <input type="password" id="senha" name="senha" required />
-      </div>
-
-      <button type="submit" class="submit-btn">Cadastrar</button>
-    </form>
-  </body>
-</html>
diff --git a/index.php b/index.php
new file mode 100644
index 0000000..ca77c92
--- /dev/null
+++ b/index.php
@@ -0,0 +1,116 @@
+<?php
+// Inclui arquivo de configuração do banco
+include('config.php');
+
+// Consulta SQL para buscar todos os produtos
+$query = "SELECT * FROM produtos";
+$resultado = mysqli_query($db, $query);
+?>
+
+<!DOCTYPE html>
+<html lang="pt-BR">
+<head>
+    <meta charset="UTF-8">
+    <meta name="viewport" content="width=device-width, initial-scale=1.0">
+    <link rel="stylesheet" href="crieconta.css">
+    <title>Lista de Produtos</title>
+    <style>
+        table {
+            width: 100%;
+            border-collapse: collapse;
+            margin-top: 20px;
+        }
+        th, td {
+            padding: 10px;
+            text-align: left;
+            border-bottom: 1px solid #ddd;
+        }
+        th {
+            background-color: #f2f2f2;
+        }
+        .container_lista {
+            width: 80%;
+            margin: 20px auto;
+            padding: 20px;
+            background-color: #fff;
+            border-radius: 8px;
+            box-shadow: 0 0 10px rgba(0,0,0,0.1);
+        }
+        h2 {
+            text-align: center;
+            margin-bottom: 20px;
+        }
+        .mensagem {
+            text-align: center;
+            padding: 10px;
+            margin-bottom: 20px;
+            background-color: #e8f5e9;
+            border-radius: 4px;
+        }
+        .btn-cadastrar {
+            display: block;
+            width: 200px;
+            margin: 20px auto;
+            padding: 10px;
+            background-color: #4CAF50;
+            color: white;
+            text-decoration: none;
+            text-align: center;
+            border-radius: 4px;
+            font-weight: bold;
+        }
+        .sem-produtos {
+            text-align: center;
+            padding: 20px;
+            font-style: italic;
+            color: #666;
+        }
+    </style>
+</head>
+<body>
+    <div class="container_lista">
+        <?php
+        if(isset($_GET['msg'])) {
+            echo '<div class="mensagem">' . htmlspecialchars($_GET['msg']) . '</div>';
+        }
+        ?>
+        <h2>Lista de Produtos</h2>
+        <a href="cadastrar.php" class="btn-cadastrar">Cadastrar Novo Produto</a>
+        <?php
+        if(mysqli_num_rows($resultado) == 0) {
+            echo '<div class="sem-produtos">Não há produtos cadastrados no momento. Clique no botão acima para cadastrar um novo produto.</div>';
+        } else {
+        ?>
+        <table>
+            <thead>
+                <tr>
+                    <th>Nome</th>
+                    <th>Código</th>
+                    <th>Preço</th>
+                    <th>Estoque</th>
+                </tr>
+            </thead>
+            <tbody>
+                <?php
+                while($produto = mysqli_fetch_assoc($resultado)) {
+                    echo "<tr>";
+                    echo "<td>" . $produto['nome'] . "</td>";
+                    echo "<td>" . $produto['codigo'] . "</td>";
+                    echo "<td>R$ " . number_format($produto['preco'], 2, ',', '.') . "</td>";
+                    echo "<td>" . $produto['estoque'] . "</td>";
+                    echo "</tr>";
+                }
+                ?>
+            </tbody>
+        </table>
+        <?php
+        }
+        ?>
+    </div>
+</body>
+</html>
+
+<?php
+// Fecha a conexão com o banco
+$db->close();
+?>
diff --git a/inserir.php b/inserir.php
new file mode 100644
index 0000000..b2c9d32
--- /dev/null
+++ b/inserir.php
@@ -0,0 +1,27 @@
+<?php
+// Inclui o arquivo de configuração do banco
+include('config.php');
+
+// Verifica se o formulário foi enviado (método POST)
+if ($_SERVER['REQUEST_METHOD'] === 'POST') {
+    // Obtém os dados do formulário
+    $nome = $_POST['nome'] ?? '';
+    $codigo = $_POST['codigo'] ?? '';
+    $preco = $_POST['preco'] ?? '';
+    $estoque = $_POST['estoque'] ?? '';
+
+    // Valida se os campos estão preenchidos
+    if (empty($nome) || empty($codigo) || empty($preco) || empty($estoque)) {
+        header('Location: index.php?msg=' . urlencode('Erro: Todos os campos são obrigatórios.'));
+        close_and_exit($db);
+    }
+
+    // Prepara a consulta SQL para inserir os dados do produto no banco
+    $queryInserir = "INSERT INTO produtos (nome, codigo, preco, estoque) VALUES ('$nome', '$codigo', '$preco', '$estoque')";
+    if(mysqli_query($db, $queryInserir)) {
+        header('Location: index.php?msg=' . urlencode('Produto cadastrado com sucesso!'));
+    } else {
+        header('Location: cadastrar.php?msg=' . urlencode('Erro ao cadastrar produto: ' . mysqli_error($db)));
+    }
+    close_and_exit($db);
+}
-- 
2.43.0

